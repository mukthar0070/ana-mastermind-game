language: ruby
rvm:
  - 2.3.5

services:
  - docker

before_install:
  - gem update --system
  - gem --version

jobs:
  include:
    - stage: unit tests
      script: "bundle exec rspec spec"
    - stage: deploy to dev
      env:
        - HEROKU_APP=dev-ana-mastermind-game
      script: ./scripts/deploy_container_heroku.sh
      if: branch = master
    - stage: test dev
      script: 'curl http://$HEROKU_APP.herokuapp.com/health'
      if: branch = master
    - stage: deploy to qa
      env:
        - HEROKU_APP=qa-ana-mastermind-game
      script: ./scripts/deploy_container_heroku.sh
      if: branch = master
    - stage: test dev
      script: 'curl http://$HEROKU_APP.herokuapp.com/health'
      if: branch = master
